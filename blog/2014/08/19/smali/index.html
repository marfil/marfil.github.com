
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>smali - Marfil's world</title>
	<meta name="author" content="Marfil">

	
	<meta name="description" content="Smali 反编译 这篇重点是理清解包打包的思路。 首先，环境配置中我安装了APKDB这个(win7x64)，算是软件吧。它可以反编译和打包，节省很多打命令的时间，我的重点在破包与解开业务逻辑，这方面有兴趣的同学可以自己深入研究。 安装好后有个比较赞的功能，apk的图标就是icon图标，方便查找 &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Marfil's world" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Marfil's world</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Home</a></li>
	<li><a href="/blog/categories/learn">Learn</a></li>
	<li><a href="/blog/categories/game">Game</a></li>
	<li><a href="/blog/categories/draw">Draw</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/category-cloud">Category</a></li>
	
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Home</a></li>
	<li><a href="/blog/categories/learn">Learn</a></li>
	<li><a href="/blog/categories/game">Game</a></li>
	<li><a href="/blog/categories/draw">Draw</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/category-cloud">Category</a></li>
	
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
            <form action="/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:marfil.github.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
        
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
        
	</div>

    <!-- default search
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
        <input type="hidden" name="q" value="site:marfil.github.com"> 
	</form>
    -->

    <!-- tapir search
    <form method="get" action="/search.html" id="search" class="search">
        <input name="query" type="text" placeholder="Search..." x-webkit-speech />
    </form>
    -->

	<form class="search" action="/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
	</form>

</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
    
	<h2 class="title">Smali</h2>
	<div class="entry-content">
        <h3>Smali 反编译</h3>

<h4>这篇重点是理清解包打包的思路。</h4>

<hr />

<p>首先，环境配置中我安装了APKDB这个(win7x64)，算是软件吧。它可以反编译和打包，节省很多打命令的时间，我的重点在破包与解开业务逻辑，这方面有兴趣的同学可以自己深入研究。</p>

<p>安装好后有个比较赞的功能，apk的图标就是icon图标，方便查找，对小米这种有缓存要重启才能看icon图标是否替换成功的会省力些。看图</p>

<p><img src="https://4tjcfg.by3301.livefilestore.com/y2pvqDca3K0y-Y6UZ8sRNzL-Sj1mnew8oZZbJLMTqBmGGV15-mt0QxeMMr67YgOtwZ9oaGV9OqDvjjTnu4jyOJGH8wRYM8__C0sOPfb3jks7LQ/jt1.png?psid=1"></p>

<!-- more -->


<h4>开工</h4>

<p>将apk复制到工作目录，右键使用APKDB反编译</p>

<p><img src="https://4tjcfg.by3301.livefilestore.com/y2p5VEtNqEX8-Pe5K4Ioj2bS_emkIT9xAijF_riVPZQ357Ooe_O-wp4RBZqLPStNJd7iL_4FGhgZTZejc3sA0tSj1dZzMgDkMfCQZpWMvP5yyI/jt2.png?psid=1"></p>

<p>出现选项卡</p>

<p><img src="https://4tjcfg.by3301.livefilestore.com/y2pp1bemmJz5s_dXvE1IGgP1ZDpNnYJa-YuEyPqWv65bUB1Q5tCKNZfV3fhpxsEye2NjrjVCufY8gD0CexL2N8KzYgM_Ix_cM7JoJA5yhN13rA/jt3.png?psid=1"></p>

<p>选择1，回车，反编译成功会提示。</p>

<p>如果用apktool命令行请选择较高版本的jar包，官网现在最新的两个jar包虽然都是beta版本，但还是强烈建议用最新的，老版本许多apk会出现反编译错误。</p>

<h4>注意 如果要进行命令行打包并自己签名的，自己官方下载的jar包版本要与这部选择的版本相符合，否则命令行打包会失败，这个会在打包时候再次说明。</h4>

<p>成功反编译后就会看到和apk文件同名的文件夹，点进去就是反编译的目录结构。</p>

<p><img src="https://4tjcfg.by3301.livefilestore.com/y2pF91Jk8NoF_sdzrgZCj_KbiPzlzB87XWpNyv2KH-g3X6yIsjdbH70Z_K5GwWw4TfW2riiit27YSGgnoj8zVTlszr-XR244HmB7izPgdKZHAQ/jt5.png?psid=1"></p>

<ul>
<li>一个清单文件</li>
<li>一个打包规则文件</li>
<li>assets&mdash;资源文件</li>
<li>lib&mdash;so包</li>
<li>res&mdash;对应drawable一类文件</li>
<li>smali&mdash;反编译的smali文件</li>
</ul>


<p>资源替换简单，替换同名文件即可</p>

<p>下面讲讲通过修改smali文件，注入自己代码，或者是修改原文件的业务逻辑。可以制作免费包，去除广告，汉化等等工作。</p>

<p>在这里用到的时Sublime Text2(ST2)软件，添加smali插件，能够使smali语法高亮。</p>

<p>将整个目录拖入到ST2中</p>

<p><img src="https://4tjcfg.by3301.livefilestore.com/y2puFMu_hy2RXnym_qpF2Ef1IPASV72dPULK1bFRTmmkhdrf0aAocV_YN-2QJgx_-1VAHCdeqU32TKgu-Xlv0-dcyOPKo-vHJUmFEhifJoMfVw/jt6.png?psid=1"></p>

<p>smali的语法可以自行百度</p>

<p><a href="http://www.cnblogs.com/4-312/p/3158026.html">教程地址</a></p>

<h3>特别要注意的每次在一个方法里加代码，首先要检查下申请的数量，不然打包好一直报错，比较难找。如图</h3>

<p><img src="https://4tjcfg.bl3302.livefilestore.com/y2pzr4hSuwIULIg-VvPE3lmG_PotmF3rIzEnUuPCn8DQM7xruLjuVo2qRzf_VXzxb9vTBrUzJtjiA1ACCkvC6dopIi30GwCisbKtq1tH6uEW-4/locals.png?psid=1"></p>

<p>新加入的代码中有新增变量，则一定要把数量加上去。</p>

<h4>注入</h4>

<p>一般写smali代码比较复杂，也比较容易出错。所以当把原代码弄清楚后，要注入代码时，我选择的方法是自己写一个安卓项目，把要的功能封装到一个方法或者一个类的方法里面，要注入的地方调用这个方法，或者新建一个类并调用它的方法即可。</p>

<ul>
<li>步骤1用eclipse将写好的代码打包成apk</li>
<li>反编译自己的apk文件</li>
<li>整合manifest配置文件</li>
<li>将smali文件整合</li>
</ul>


<p>后半部分比较粗略，有疑问留言吧</p>

<p class='post-footer'>
            original link:<a href='http://marfil.github.com/blog/2014/08/19/smali/'>http://marfil.github.com/blog/2014/08/19/smali/</a><br/>&nbsp;written by <a href='http://marfil.github.com'>Marfil</a>&nbsp;posted at <a href='http://marfil.github.com'>http://marfil.github.com</a></p>


        <div>
        
        <a class="pull-left" href="/blog/2014/08/18/journey/" title="Previous Post: journey">&laquo; journey</a>
        
        
        <div class="clear"></div>
        </div>
        
            <div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		
		
	</div>
	
    
    <!-- JiaThis BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share?uid=1957490" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1361705530382241" charset="utf-8"></script>
<!-- JiaThis END -->

<!-- Baidu Button BEGIN 
<div id="bdshare" class="bdshare_t bds_tools_32 get-codes-bdshare">
	<a class="bds_tsina"></a>
	<a class="bds_qzone"></a>
	<a class="bds_tqq"></a>
	<a class="bds_renren"></a>
	<a class="bds_t163"></a>
	<a class="bds_hi"></a>
	<span class="bds_more"></span>
	<a class="shareCount"></a>
</div>
<script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=6839808" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
	document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000)
</script>
 Baidu Button END -->

<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1957490"></script>
<!-- UY END -->

    
</div>

        
    </div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-08-19T00:45:00+08:00" pubdate data-updated="true">Aug 19<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/learn/'>Learn</a>


</div>
    <div class="comments"><a href="#comments" id="uyan_count_unit" du="" su="">0条评论</a>
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1957490"></script>
    </div>
	

<div class="tags">
  
  <a class='tag' href='/blog/tags/android/'>android</a>
  
</div>


	
</div>

    <div class="meta">
        <div class="date">








  


<time datetime="2014-08-19T00:45:00+08:00" pubdate data-updated="true">Aug 19<span>th</span>, 2014</time></div>
        <div class="tags">


	<a class='category' href='/blog/categories/learn/'>Learn</a>


</div>
        <div class="comments"><a href="#comments" id="uyan_count_unit" du="" su="">0条评论</a>
            <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1957490"></script>
        </div>
        

<div class="tags">
  
  <a class='tag' href='/blog/tags/android/'>android</a>
  
</div>


        <br />
        <section>
            <h2>相关文章：</h2>
            <ul class="posts">
                
            </ul>
        </section>
        <br />
        <section>
 <h1>分类目录</h1>
 <ul id="categories">
	 <li class='category'><a href='/blog/categories/draw/'>Draw (1)</a></li>
<li class='category'><a href='/blog/categories/game/'>Game (2)</a></li>
<li class='category'><a href='/blog/categories/learn/'>Learn (2)</a></li>

 </ul>
</section>

        <br />
        <section>
  <h1>最近博文</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/08/19/smali/">smali</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/18/journey/">journey</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/14/first-draw/">画画第一课</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/14/first-lean/">学习第一课</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/14/first-game/">游戏第一课</a>
      </li>
    
  </ul>
</section>

        <br />
    </div>
</article>

</div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Marfil


</footer>
	<script src="/javascripts/slash.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53829357-1', '812lcl.com');
  ga('send', 'pageview');

</script>



    <!--返回顶部开始-->
<!--   <div id="full" style="width:0px; height:0px; position:fixed; right:180px; bottom:150px; z-index:100; text-align:center; background-color:transparent; cursor:pointer;">
	<a href="#" onclick="goTop();return false;"><img src="/images/top.png" border=0 alt="返回顶部"></a>
</div>
<script src="/javascripts/top.js" type="text/javascript"></script>  -->
<!--返回顶部结束-->

</body>
</html>
